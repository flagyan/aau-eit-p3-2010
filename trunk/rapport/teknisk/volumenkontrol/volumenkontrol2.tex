\subsection*{VCO}
\label{volumenkontrol-design-vco}

En VCO, Voltage Controlled Oscillator, leverer et konstant signal hvor frekvensen er afhængig af en kontrolspænding. Kontrolspændingen er spændingen over $C_2$, ladekondensatoren, minus én diodespænding. Der er taget udgangspunkt i en VCO fra databladet for en LM324 \cite{lm324-datablad}. VCO'en kan deles op i to blokke; én integrator og én schmitt-trigger. Det er udgangen fra schmitt-triggeren der bestemmer hvilken af de to spændinger integratoren arbejder udfra. Triggerspændingerne på schmitt-triggeren er givet ved udtrykkene i formel (\ref{equ:vco1}) og formel (\ref{equ:vco2}). Forsyningsspændingen, $V_{CC}$, er 5 V.

\begin{equation}
\label{equ:vco1}
V_L = \frac{1}{3} \cdot V_{CC} = 1,67~\mathrm{V}
\end{equation}

\begin{equation}
\label{equ:vco2}
V_U = \frac{2}{3} \cdot V_{CC} - 0,5~\mathrm{V} = 2,83~\mathrm{V}
\end{equation}

Frekvensen VCO'en vil svinge med, er givet ved udtrykket i formel (\ref{equ:vco3}). Dette udtryk er udledt i Appendiks A??.

\begin{equation}
\label{equ:vco3}
f = \frac{3 \cdot V_C \cdot (R_1 - R_4)}{(2 \cdot V_{CC} - 3~\mathrm{V}) \cdot C \cdot (R_1)^2}
\end{equation}

Forholdet mellem høj og lav, duty-cycle, for udgangssignalet fra VCO'en er givet ved forholdet mellem $R_1$ og $R_4$, i dette tilfælde $\frac{R_4}{R_1} = \frac{40~\mathrm{k}\ohm}{80~\mathrm{k}\ohm}=0.5$ Denne formel er udledt i Appendiks A og baggrunden for den er, at det er disse to modstande $C_1$ op- og aflades igennem. Grunden til at frekvensen stiger når spændingen stiger, er at operationsforstærkeren altid vil presse sine indgange til at være ens. Da der på plus-indgangen sidder en spændingsdeling, som giver halvdelen af kontrolspændingen, vil der ligge det samme på minus-indgangen. Dette betyder, at spændingsfaldet over $R_1$ altid vil være halvdelen af kontrolspændingen. Dette vil betyde at der vil løbe en strøm igennem $R_1$ ind i kondensatoren. Når transistoren leder, vil den lede strømmen, som løber igennem $R_1$ samt den strøm der kommer fra kondensatoren. Når kondensatoren aflader igennem transistoren vil den prøve at trække minus-indgangen ned, hvilket operationsforstærkeren modarbejder ved at øge sin outputspænding. Hvis man lader denne proces fortsætte uendeligt vil plus- og minus-indgangene være ens, indtil operationsforstærkeren rammer sin maksimale spænding. Herefter vil den ikke være i stand til at regulere spændingen på minus-indgangen, hvilket vil resultere i at spændingen på minus-indgangen vil være spændingsdelingen mellem $R_1$ og $R_4$. Dette forhindrer schmitt-triggeren dog, ved at ændre på hvor strømmen igennem $R_1$ har mulighed for at løbe hen. Når der løber strøm til $C_1$ vil dette føre til en spændingstigning. Da operationsforstærkeren stadig vil forsøge at holde indgangene ens, vil dette betyde et spændingsfald på outputtet. Det er denne effekt der gør svingningen mulig.

Outputtet fra schmitt-triggeren er højt, som standard, da outputtet fra integratoren, når denne ikke har en høj nok styringsspænding til at gå i gang, vil være lavt. Dette betyder at AND-gaten der giver signalet videre til tælleren kan give et positivt output, når en knap trykkes ned en enkelt gang. På denne måde vil det være muligt at benytte knapperne til at regulere et enkelt niveau op eller ned, samtidig med muligheden for at holde dem inde, og aktivere VCO'en, for at regulere volumeniveauet hurtigere.


%Denne strøm kan kun løbe ind i kondensatoren, hvilket vil oplade denne. Når kondensatoren aflades gennem $R_4$ vil minusbenet gå mod en lavere spænding. For at undgå dette vil op-ampen outputte en højere spænding, for at forsøge at holde begge input på samme spændingsniveau. Kondensatoren blev ved med at aflade, ville op-ampen til sidst nå sit maksimale output. Når dette sker, vil minus benet falde til en spændingsdeling mellem $R_1$ og $R_4$, hvis transistoren $Q_1$ ses som en kortslutning. Dette vil dog ikke ske i praksis, da schmidt-triggeren forhindrer netop dette. 


%I takt med at spændingen stiger over ladekondensatoren vil spændingen over $R_1$ og $R_2$ stige. Dette vil betyde at strømmen ind i kondensatoren, $C_1$ bliver større. Dette forklarer hvordan low-tiden bliver mindre. Kondensatoren vil stadig skulle aflade igennem $R_4$, hvilket umiddelbart ikke lægger op til en kortere høj-tid. Dog vil spændingen over $R_2$ også stige, hvilket gør outputtet fra integratoren højere. Dette vil betyde en lavere spænding over kondensatoren, hvilket vil betyde at den ikke kan lade lige så meget op og den derfor hurtigere kan aflades.
%Hvis V_C stiger vil spændingen på V_+ stige og dermed også V_-. Det vil lave en størrer spænding over R_1 og R_4, og strømmen igennem dem vil så også stige. Hvis kondensatorens kapacitet er konstant og strømmen den op- og aflades med er stigende vil op- og afladetiden falde.